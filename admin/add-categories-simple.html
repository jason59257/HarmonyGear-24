<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Import Homepage Categories - Admin Panel</title>
    <link rel="stylesheet" href="/css/styles.css">
    <link rel="stylesheet" href="/admin/css/admin.css">
    <style>
        .category-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 10px;
            margin: 20px 0;
        }
        .category-item {
            padding: 12px;
            border: 1px solid var(--admin-border);
            border-radius: 6px;
            background: white;
            font-size: 14px;
        }
        .category-item.added {
            background: #d4edda;
            border-color: #c3e6cb;
        }
        .category-item.error {
            background: #f8d7da;
            border-color: #f5c6cb;
        }
        .status-badge {
            display: inline-block;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 11px;
            margin-left: 8px;
        }
        .status-pending {
            background: #fff3cd;
            color: #856404;
        }
        .status-success {
            background: #d4edda;
            color: #155724;
        }
        .status-error {
            background: #f8d7da;
            color: #721c24;
        }
    </style>
</head>
<body class="admin-body">
    <!-- Sidebar -->
    <aside class="admin-sidebar">
        <div class="admin-sidebar-header">
            <h2>HarmonyGear 24</h2>
            <p>Admin Panel</p>
        </div>
        
        <nav class="admin-sidebar-nav">
            <a href="dashboard.html" class="admin-nav-item">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M3 9L12 2L21 9V20C21 20.5304 20.7893 21.0391 20.4142 21.4142C20.0391 21.7893 19.5304 22 19 22H5C4.46957 22 3.96086 21.7893 3.58579 21.4142C3.21071 21.0391 3 20.5304 3 20V9Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    <path d="M9 22V12H15V22" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
                <span>Dashboard</span>
            </a>
            <a href="categories.html" class="admin-nav-item active">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <rect x="3" y="3" width="7" height="7" stroke="currentColor" stroke-width="2"/>
                    <rect x="14" y="3" width="7" height="7" stroke="currentColor" stroke-width="2"/>
                    <rect x="14" y="14" width="7" height="7" stroke="currentColor" stroke-width="2"/>
                    <rect x="3" y="14" width="7" height="7" stroke="currentColor" stroke-width="2"/>
                </svg>
                <span>Categories</span>
            </a>
        </nav>
        
        <div class="admin-sidebar-footer">
            <a href="../index.html" class="admin-nav-item">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M9 22V12H15V22" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    <path d="M3 9L12 2L21 9V20C21 20.5304 20.7893 21.0391 20.4142 21.4142C20.0391 21.7893 19.5304 22 19 22H5C4.46957 22 3.96086 21.7893 3.58579 21.4142C3.21071 21.0391 3 20.5304 3 20V9Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
                <span>Back to Website</span>
            </a>
        </div>
    </aside>

    <!-- Main Content -->
    <main class="admin-main">
        <header class="admin-header">
            <div class="admin-header-left">
                <button class="admin-menu-toggle" id="adminMenuToggle">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M3 12H21M3 6H21M3 18H21" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                </button>
                <h1>Import Homepage Categories</h1>
            </div>
            <div class="admin-header-right">
                <a href="categories.html" class="admin-btn">Back to Categories</a>
                <div class="admin-user-info">
                    <span id="adminUserEmail">admin@harmonygear24.com</span>
                </div>
            </div>
        </header>

        <div class="admin-content">
            <div class="admin-card" style="margin-bottom: 20px;">
                <div class="admin-card-header">
                    <h2>Import Homepage Categories</h2>
                </div>
                <div class="admin-card-body">
                    <p>This page will help you import all 19 categories from the homepage into the backend database.</p>
                    <p style="color: var(--admin-text-light); margin-top: 10px;">Click the button below to start importing. The system will automatically check for existing categories to avoid duplicates.</p>
                </div>
            </div>

            <div class="admin-card">
                <div class="admin-card-body">
                    <div style="text-align: center; margin: 30px 0;">
                        <button class="admin-btn admin-btn-primary" id="importBtn" style="padding: 15px 40px; font-size: 16px;">
                            üì• Import All Categories
                        </button>
                    </div>
                    
                    <div id="statusMessage" style="margin: 20px 0; padding: 15px; border-radius: 6px; display: none;"></div>
                    
                    <div class="category-list" id="categoryList"></div>
                </div>
            </div>
        </div>
    </main>

    <script src="/admin/js/admin.js"></script>
    <script type="module">
        // Import API
        let CategoryAPI;
        
        try {
            const apiModule = await import('/admin/js/api-real.js');
            CategoryAPI = apiModule.CategoryAPI;
            console.log('‚úÖ API module loaded');
        } catch (error) {
            console.error('‚ùå Failed to load API module:', error);
            document.getElementById('statusMessage').style.display = 'block';
            document.getElementById('statusMessage').style.background = '#f8d7da';
            document.getElementById('statusMessage').style.color = '#721c24';
            document.getElementById('statusMessage').innerHTML = 'Failed to load API module. Please check console for errors.';
        }
        
        // Check authentication
        const token = localStorage.getItem('authToken') || localStorage.getItem('adminToken');
        if (!token) {
            window.location.href = '/admin/login.html';
        }
        
        // Set admin email
        const adminEmail = localStorage.getItem('adminEmail');
        if (adminEmail) {
            const emailEl = document.getElementById('adminUserEmail');
            if (emailEl) {
                emailEl.textContent = adminEmail;
            }
        }
        
        // Sidebar toggle
        const menuToggle = document.getElementById('adminMenuToggle');
        if (menuToggle) {
            menuToggle.addEventListener('click', function() {
                const sidebar = document.querySelector('.admin-sidebar');
                if (sidebar) {
                    sidebar.classList.toggle('collapsed');
                }
            });
        }
        
        const categories = [
            { name: 'Travel & Vacations', slug: 'travel', icon: '‚úàÔ∏è', description: 'Travel deals and vacation packages', sort_order: 1 },
            { name: 'Clothing', slug: 'clothing', icon: 'üëï', description: 'Fashion and apparel', sort_order: 2 },
            { name: 'Beauty & Wellness', slug: 'beauty', icon: 'üíÑ', description: 'Beauty products and wellness services', sort_order: 3 },
            { name: 'Accessories', slug: 'accessories', icon: 'üëú', description: 'Fashion accessories', sort_order: 4 },
            { name: 'Auto & Tires', slug: 'auto', icon: 'üöó', description: 'Automotive and tire deals', sort_order: 5 },
            { name: 'Baby & Toddler', slug: 'baby', icon: 'üë∂', description: 'Baby and toddler products', sort_order: 6 },
            { name: 'Banking & Finance Tools', slug: 'banking', icon: 'üí≥', description: 'Banking and financial services', sort_order: 7 },
            { name: 'Business Supplies & Services', slug: 'business', icon: 'üíº', description: 'Business supplies and services', sort_order: 8 },
            { name: 'Digital Services & Streaming', slug: 'digital', icon: 'üì±', description: 'Digital services and streaming platforms', sort_order: 9 },
            { name: 'Electronics', slug: 'electronics', icon: 'üì∫', description: 'Electronics and tech products', sort_order: 10 },
            { name: 'Events & Entertainment', slug: 'events', icon: 'üé≠', description: 'Events and entertainment tickets', sort_order: 11 },
            { name: 'Food, Drinks & Restaurants', slug: 'food', icon: 'üçî', description: 'Food, drinks and restaurant deals', sort_order: 12 },
            { name: 'Gifts, Flowers & Parties', slug: 'gifts', icon: 'üéÅ', description: 'Gifts, flowers and party supplies', sort_order: 13 },
            { name: 'Home & Garden', slug: 'home', icon: 'üè†', description: 'Home and garden products', sort_order: 14 },
            { name: 'Pets', slug: 'pets', icon: 'üêæ', description: 'Pet supplies and services', sort_order: 15 },
            { name: 'Shoes', slug: 'shoes', icon: 'üëü', description: 'Footwear and shoes', sort_order: 16 },
            { name: 'Sports, Outdoors & Fitness', slug: 'sports', icon: '‚öΩ', description: 'Sports, outdoor and fitness equipment', sort_order: 17 },
            { name: 'Subscription Boxes & Services', slug: 'subscription', icon: 'üì¶', description: 'Subscription boxes and services', sort_order: 18 },
            { name: 'Toys & Games', slug: 'toys', icon: 'üéÆ', description: 'Toys and games', sort_order: 19 }
        ];
        
        // Display categories list
        function renderCategories() {
            const list = document.getElementById('categoryList');
            if (!list) {
                console.error('Category list element not found');
                return;
            }
            
            list.innerHTML = categories.map(cat => `
                <div class="category-item" id="cat-${cat.slug}">
                    ${cat.icon} <strong>${cat.name}</strong>
                    <span class="status-badge status-pending" id="status-${cat.slug}">Pending</span>
                </div>
            `).join('');
            console.log('‚úÖ Categories list rendered');
        }
        
        // Import all categories
        async function importAllCategories() {
            console.log('üöÄ Import started');
            
            if (!CategoryAPI) {
                alert('API not loaded. Please refresh the page.');
                return;
            }
            
            const btn = document.getElementById('importBtn');
            const statusMsg = document.getElementById('statusMessage');
            
            if (!btn) {
                console.error('Import button not found');
                return;
            }
            
            btn.disabled = true;
            btn.textContent = 'Importing...';
            if (statusMsg) {
                statusMsg.style.display = 'none';
            }
            
            let successCount = 0;
            let errorCount = 0;
            let skipCount = 0;
            
            console.log('Starting import of', categories.length, 'categories...');
            
            for (const category of categories) {
                const item = document.getElementById(`cat-${category.slug}`);
                const status = document.getElementById(`status-${category.slug}`);
                
                try {
                    console.log(`Checking: ${category.name}...`);
                    
                    // Check if category already exists
                    const allCategories = await CategoryAPI.getAll();
                    console.log('All categories response:', allCategories);
                    
                    const exists = allCategories.success && 
                        allCategories.data && 
                        allCategories.data.some(c => c.slug === category.slug);
                    
                    if (exists) {
                        if (item) item.classList.add('added');
                        if (status) {
                            status.textContent = 'Exists';
                            status.className = 'status-badge status-success';
                        }
                        skipCount++;
                        console.log(`‚è≠Ô∏è Skipped (exists): ${category.name}`);
                        continue;
                    }
                    
                    // Add category
                    console.log(`‚ûï Adding: ${category.name}`);
                    const result = await CategoryAPI.create(category);
                    console.log('Create result:', result);
                    
                    if (result.success) {
                        if (item) item.classList.add('added');
                        if (status) {
                            status.textContent = 'Added';
                            status.className = 'status-badge status-success';
                        }
                        successCount++;
                        console.log(`‚úÖ Added: ${category.name}`);
                    } else {
                        if (item) item.classList.add('error');
                        if (status) {
                            status.textContent = 'Failed';
                            status.className = 'status-badge status-error';
                        }
                        errorCount++;
                        console.error(`‚ùå Failed to add ${category.name}:`, result.error);
                    }
                } catch (error) {
                    if (item) item.classList.add('error');
                    if (status) {
                        status.textContent = 'Error';
                        status.className = 'status-badge status-error';
                    }
                    errorCount++;
                    console.error(`‚ùå Error adding ${category.name}:`, error);
                }
                
                // Delay to avoid rate limiting
                await new Promise(resolve => setTimeout(resolve, 300));
            }
            
            // Show results
            if (statusMsg) {
                statusMsg.style.display = 'block';
                statusMsg.style.background = errorCount > 0 ? '#f8d7da' : '#d4edda';
                statusMsg.style.color = errorCount > 0 ? '#721c24' : '#155724';
                statusMsg.innerHTML = `
                    <strong>Import Complete!</strong><br>
                    Success: ${successCount} | Skipped: ${skipCount} | Failed: ${errorCount}
                    ${errorCount === 0 ? '<br><a href="categories.html" style="color: inherit; text-decoration: underline;">View Categories</a>' : ''}
                `;
            }
            
            btn.disabled = false;
            btn.textContent = 'Import Again';
            
            console.log(`‚úÖ Import complete! Success: ${successCount}, Skipped: ${skipCount}, Failed: ${errorCount}`);
        }
        
        // Make function globally accessible
        window.importAllCategories = importAllCategories;
        
        // Initialize when page loads
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üìÑ Page loaded, initializing...');
            renderCategories();
            
            // Attach click handler
            const importBtn = document.getElementById('importBtn');
            if (importBtn) {
                importBtn.addEventListener('click', function(e) {
                    e.preventDefault();
                    console.log('üîò Button clicked!');
                    importAllCategories();
                });
                console.log('‚úÖ Event listener attached to button');
            } else {
                console.error('‚ùå Import button not found on page load');
            }
        });
    </script>
</body>
</html>
