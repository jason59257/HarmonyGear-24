<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Add Homepage Categories - Admin Panel</title>
    <link rel="stylesheet" href="/css/styles.css">
    <link rel="stylesheet" href="/admin/css/admin.css">
    <style>
        .category-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 10px;
            margin: 20px 0;
        }
        .category-item {
            padding: 10px;
            border: 1px solid var(--admin-border);
            border-radius: 6px;
            background: white;
        }
        .category-item.added {
            background: #d4edda;
            border-color: #c3e6cb;
        }
        .category-item.error {
            background: #f8d7da;
            border-color: #f5c6cb;
        }
        .status-badge {
            display: inline-block;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 12px;
            margin-left: 8px;
        }
        .status-pending {
            background: #fff3cd;
            color: #856404;
        }
        .status-success {
            background: #d4edda;
            color: #155724;
        }
        .status-error {
            background: #f8d7da;
            color: #721c24;
        }
    </style>
</head>
<body class="admin-body">
    <!-- Sidebar -->
    <aside class="admin-sidebar">
        <div class="admin-sidebar-header">
            <h2>HarmonyGear 24</h2>
            <p>Admin Panel</p>
        </div>
        
        <nav class="admin-sidebar-nav">
            <a href="dashboard.html" class="admin-nav-item">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M3 9L12 2L21 9V20C21 20.5304 20.7893 21.0391 20.4142 21.4142C20.0391 21.7893 19.5304 22 19 22H5C4.46957 22 3.96086 21.7893 3.58579 21.4142C3.21071 21.0391 3 20.5304 3 20V9Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    <path d="M9 22V12H15V22" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
                <span>Dashboard</span>
            </a>
            <a href="categories.html" class="admin-nav-item active">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <rect x="3" y="3" width="7" height="7" stroke="currentColor" stroke-width="2"/>
                    <rect x="14" y="3" width="7" height="7" stroke="currentColor" stroke-width="2"/>
                    <rect x="14" y="14" width="7" height="7" stroke="currentColor" stroke-width="2"/>
                    <rect x="3" y="14" width="7" height="7" stroke="currentColor" stroke-width="2"/>
                </svg>
                <span>Categories</span>
            </a>
        </nav>
        
        <div class="admin-sidebar-footer">
            <a href="../index.html" class="admin-nav-item">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M9 22V12H15V22" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    <path d="M3 9L12 2L21 9V20C21 20.5304 20.7893 21.0391 20.4142 21.4142C20.0391 21.7893 19.5304 22 19 22H5C4.46957 22 3.96086 21.7893 3.58579 21.4142C3.21071 21.0391 3 20.5304 3 20V9Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
                <span>Back to Website</span>
            </a>
        </div>
    </aside>

    <!-- Main Content -->
    <main class="admin-main">
        <header class="admin-header">
            <div class="admin-header-left">
                <button class="admin-menu-toggle" id="adminMenuToggle">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M3 12H21M3 6H21M3 18H21" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                </button>
                <h1>å¯¼å…¥ä¸»é¡µåˆ†ç±»</h1>
            </div>
            <div class="admin-header-right">
                <a href="categories.html" class="admin-btn">è¿”å›åˆ†ç±»ç®¡ç†</a>
                <div class="admin-user-info">
                    <span id="adminUserEmail">admin@harmonygear24.com</span>
                </div>
            </div>
        </header>

        <div class="admin-content">
            <div class="admin-card" style="margin-bottom: 20px;">
                <div class="admin-card-header">
                    <h2>æ·»åŠ ä¸»é¡µåˆ†ç±»åˆ°åå°ç³»ç»Ÿ</h2>
                </div>
                <div class="admin-card-body">
                    <p>è¿™ä¸ªé¡µé¢ä¼šå¸®ä½ å°†ä¸»é¡µä¸­çš„æ‰€æœ‰ 19 ä¸ªåˆ†ç±»æ·»åŠ åˆ°åå°æ•°æ®åº“ä¸­ã€‚</p>
                    <p style="color: var(--admin-text-light); margin-top: 10px;">ç‚¹å‡»ä¸‹é¢çš„æŒ‰é’®å¼€å§‹å¯¼å…¥ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨æ£€æŸ¥å·²å­˜åœ¨çš„åˆ†ç±»ï¼Œé¿å…é‡å¤æ·»åŠ ã€‚</p>
                </div>
            </div>

            <div class="admin-card">
                <div class="admin-card-body">
                    <div style="text-align: center; margin: 30px 0;">
                        <button class="admin-btn admin-btn-primary" id="importBtn" onclick="importAllCategories()" style="padding: 15px 40px; font-size: 16px;">
                            ğŸ“¥ ä¸€é”®å¯¼å…¥æ‰€æœ‰åˆ†ç±»
                        </button>
                    </div>
                    
                    <div id="statusMessage" style="margin: 20px 0; padding: 15px; border-radius: 6px; display: none;"></div>
                    
                    <div class="category-list" id="categoryList"></div>
                </div>
            </div>
        </div>
    </main>

    <script src="js/admin.js"></script>
    <script type="module">
        import { CategoryAPI } from './js/api-real.js';
        
        // Check authentication
        const token = localStorage.getItem('authToken') || localStorage.getItem('adminToken');
        if (!token) {
            window.location.href = 'login.html';
        }
        
        // Set admin email
        const adminEmail = localStorage.getItem('adminEmail');
        if (adminEmail) {
            document.getElementById('adminUserEmail').textContent = adminEmail;
        }
        
        // Sidebar toggle
        document.getElementById('adminMenuToggle').addEventListener('click', function() {
            document.querySelector('.admin-sidebar').classList.toggle('collapsed');
        });
        
        const categories = [
            { name: 'Travel & Vacations', slug: 'travel', icon: 'âœˆï¸', description: 'Travel deals and vacation packages', sort_order: 1 },
            { name: 'Clothing', slug: 'clothing', icon: 'ğŸ‘•', description: 'Fashion and apparel', sort_order: 2 },
            { name: 'Beauty & Wellness', slug: 'beauty', icon: 'ğŸ’„', description: 'Beauty products and wellness services', sort_order: 3 },
            { name: 'Accessories', slug: 'accessories', icon: 'ğŸ‘œ', description: 'Fashion accessories', sort_order: 4 },
            { name: 'Auto & Tires', slug: 'auto', icon: 'ğŸš—', description: 'Automotive and tire deals', sort_order: 5 },
            { name: 'Baby & Toddler', slug: 'baby', icon: 'ğŸ‘¶', description: 'Baby and toddler products', sort_order: 6 },
            { name: 'Banking & Finance Tools', slug: 'banking', icon: 'ğŸ’³', description: 'Banking and financial services', sort_order: 7 },
            { name: 'Business Supplies & Services', slug: 'business', icon: 'ğŸ’¼', description: 'Business supplies and services', sort_order: 8 },
            { name: 'Digital Services & Streaming', slug: 'digital', icon: 'ğŸ“±', description: 'Digital services and streaming platforms', sort_order: 9 },
            { name: 'Electronics', slug: 'electronics', icon: 'ğŸ“º', description: 'Electronics and tech products', sort_order: 10 },
            { name: 'Events & Entertainment', slug: 'events', icon: 'ğŸ­', description: 'Events and entertainment tickets', sort_order: 11 },
            { name: 'Food, Drinks & Restaurants', slug: 'food', icon: 'ğŸ”', description: 'Food, drinks and restaurant deals', sort_order: 12 },
            { name: 'Gifts, Flowers & Parties', slug: 'gifts', icon: 'ğŸ', description: 'Gifts, flowers and party supplies', sort_order: 13 },
            { name: 'Home & Garden', slug: 'home', icon: 'ğŸ ', description: 'Home and garden products', sort_order: 14 },
            { name: 'Pets', slug: 'pets', icon: 'ğŸ¾', description: 'Pet supplies and services', sort_order: 15 },
            { name: 'Shoes', slug: 'shoes', icon: 'ğŸ‘Ÿ', description: 'Footwear and shoes', sort_order: 16 },
            { name: 'Sports, Outdoors & Fitness', slug: 'sports', icon: 'âš½', description: 'Sports, outdoor and fitness equipment', sort_order: 17 },
            { name: 'Subscription Boxes & Services', slug: 'subscription', icon: 'ğŸ“¦', description: 'Subscription boxes and services', sort_order: 18 },
            { name: 'Toys & Games', slug: 'toys', icon: 'ğŸ®', description: 'Toys and games', sort_order: 19 }
        ];
        
        // æ˜¾ç¤ºåˆ†ç±»åˆ—è¡¨
        function renderCategories() {
            const list = document.getElementById('categoryList');
            list.innerHTML = categories.map(cat => `
                <div class="category-item" id="cat-${cat.slug}">
                    ${cat.icon} <strong>${cat.name}</strong>
                    <span class="status-badge status-pending" id="status-${cat.slug}">å¾…æ·»åŠ </span>
                </div>
            `).join('');
        }
        
        // å¯¼å…¥æ‰€æœ‰åˆ†ç±»
        window.importAllCategories = async function() {
            const btn = document.getElementById('importBtn');
            const statusMsg = document.getElementById('statusMessage');
            
            btn.disabled = true;
            btn.textContent = 'æ­£åœ¨å¯¼å…¥...';
            statusMsg.style.display = 'none';
            
            let successCount = 0;
            let errorCount = 0;
            let skipCount = 0;
            
            for (const category of categories) {
                const item = document.getElementById(`cat-${category.slug}`);
                const status = document.getElementById(`status-${category.slug}`);
                
                try {
                    // å…ˆæ£€æŸ¥æ˜¯å¦å·²å­˜åœ¨
                    const allCategories = await CategoryAPI.getAll();
                    const exists = allCategories.success && 
                        allCategories.data && 
                        allCategories.data.some(c => c.slug === category.slug);
                    
                    if (exists) {
                        item.classList.add('added');
                        status.textContent = 'å·²å­˜åœ¨';
                        status.className = 'status-badge status-success';
                        skipCount++;
                        continue;
                    }
                    
                    // æ·»åŠ åˆ†ç±»
                    const result = await CategoryAPI.create(category);
                    
                    if (result.success) {
                        item.classList.add('added');
                        status.textContent = 'å·²æ·»åŠ ';
                        status.className = 'status-badge status-success';
                        successCount++;
                    } else {
                        item.classList.add('error');
                        status.textContent = 'å¤±è´¥';
                        status.className = 'status-badge status-error';
                        errorCount++;
                        console.error(`Failed to add ${category.name}:`, result.error);
                    }
                } catch (error) {
                    item.classList.add('error');
                    status.textContent = 'é”™è¯¯';
                    status.className = 'status-badge status-error';
                    errorCount++;
                    console.error(`Error adding ${category.name}:`, error);
                }
                
                // å»¶è¿Ÿä»¥é¿å…è¯·æ±‚è¿‡å¿«
                await new Promise(resolve => setTimeout(resolve, 300));
            }
            
            // æ˜¾ç¤ºç»“æœ
            statusMsg.style.display = 'block';
            statusMsg.style.background = errorCount > 0 ? '#f8d7da' : '#d4edda';
            statusMsg.style.color = errorCount > 0 ? '#721c24' : '#155724';
            statusMsg.innerHTML = `
                <strong>å¯¼å…¥å®Œæˆï¼</strong><br>
                æˆåŠŸ: ${successCount} | è·³è¿‡: ${skipCount} | å¤±è´¥: ${errorCount}
                ${errorCount === 0 ? '<br><a href="categories.html">ç‚¹å‡»æŸ¥çœ‹åˆ†ç±»åˆ—è¡¨</a>' : ''}
            `;
            
            btn.disabled = false;
            btn.textContent = 'é‡æ–°å¯¼å…¥';
        };
        
        // åˆå§‹åŒ–
        renderCategories();
        
        // æ£€æŸ¥æ˜¯å¦å·²ç™»å½•
        const token = localStorage.getItem('authToken') || localStorage.getItem('adminToken');
        if (!token) {
            document.getElementById('statusMessage').style.display = 'block';
            document.getElementById('statusMessage').style.background = '#f8d7da';
            document.getElementById('statusMessage').style.color = '#721c24';
            document.getElementById('statusMessage').innerHTML = 'è¯·å…ˆç™»å½•ï¼<a href="login.html">ç‚¹å‡»ç™»å½•</a>';
            document.getElementById('importBtn').disabled = true;
        }
    </script>
</body>
</html>
